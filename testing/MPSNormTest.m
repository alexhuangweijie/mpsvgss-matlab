% MPSNormTest.m
% test for MPSNorm.m, a function which normalises a matrix product state
% Oliver Thomson Brown
% 2015-07-17

% test matrix product states -- CompMPS calls MPSNorm just before returning
mps230 = CompMPS(2, 3, 0);
mps240 = CompMPS(2, 4, 0);
mps330 = CompMPS(3, 3, 0);
mps242 = CompMPS(2, 4, 2);
mps332 = CompMPS(3, 3, 2);

% tolerance
tol = 1E-12;

% initialise state-vectors
psi230 = complex(zeros(2^3,1));
psi240 = complex(zeros(2^4,1));
psi330 = complex(zeros(3^3,1));
psi242 = complex(zeros(2^4,1));
psi332 = complex(zeros(3^3,1));

% rebuild state-vectors
% 230
psi230(1) = mps230{1}(:,:,1) * mps230{2}(:,:,1) * mps230{3}(:,:,1);
psi230(2) = mps230{1}(:,:,1) * mps230{2}(:,:,1) * mps230{3}(:,:,2);
psi230(3) = mps230{1}(:,:,1) * mps230{2}(:,:,2) * mps230{3}(:,:,1);
psi230(4) = mps230{1}(:,:,1) * mps230{2}(:,:,2) * mps230{3}(:,:,2);
psi230(5) = mps230{1}(:,:,2) * mps230{2}(:,:,1) * mps230{3}(:,:,1);
psi230(6) = mps230{1}(:,:,2) * mps230{2}(:,:,1) * mps230{3}(:,:,2);
psi230(7) = mps230{1}(:,:,2) * mps230{2}(:,:,2) * mps230{3}(:,:,1);
psi230(8) = mps230{1}(:,:,2) * mps230{2}(:,:,2) * mps230{3}(:,:,2);
% 240
psi240(1) = mps240{1}(:,:,1) * mps240{2}(:,:,1) * mps240{3}(:,:,1) * mps240{4}(:,:,1);
psi240(2) = mps240{1}(:,:,1) * mps240{2}(:,:,1) * mps240{3}(:,:,1) * mps240{4}(:,:,2);
psi240(3) = mps240{1}(:,:,1) * mps240{2}(:,:,1) * mps240{3}(:,:,2) * mps240{4}(:,:,1);
psi240(4) = mps240{1}(:,:,1) * mps240{2}(:,:,1) * mps240{3}(:,:,2) * mps240{4}(:,:,2);
psi240(5) = mps240{1}(:,:,1) * mps240{2}(:,:,2) * mps240{3}(:,:,1) * mps240{4}(:,:,1);
psi240(6) = mps240{1}(:,:,1) * mps240{2}(:,:,2) * mps240{3}(:,:,1) * mps240{4}(:,:,2);
psi240(7) = mps240{1}(:,:,1) * mps240{2}(:,:,2) * mps240{3}(:,:,2) * mps240{4}(:,:,1);
psi240(8) = mps240{1}(:,:,1) * mps240{2}(:,:,2) * mps240{3}(:,:,2) * mps240{4}(:,:,2);
psi240(9) = mps240{1}(:,:,2) * mps240{2}(:,:,1) * mps240{3}(:,:,1) * mps240{4}(:,:,1);
psi240(10) = mps240{1}(:,:,2) * mps240{2}(:,:,1) * mps240{3}(:,:,1) * mps240{4}(:,:,2);
psi240(11) = mps240{1}(:,:,2) * mps240{2}(:,:,1) * mps240{3}(:,:,2) * mps240{4}(:,:,1);
psi240(12) = mps240{1}(:,:,2) * mps240{2}(:,:,1) * mps240{3}(:,:,2) * mps240{4}(:,:,2);
psi240(13) = mps240{1}(:,:,2) * mps240{2}(:,:,2) * mps240{3}(:,:,1) * mps240{4}(:,:,1);
psi240(14) = mps240{1}(:,:,2) * mps240{2}(:,:,2) * mps240{3}(:,:,1) * mps240{4}(:,:,2);
psi240(15) = mps240{1}(:,:,2) * mps240{2}(:,:,2) * mps240{3}(:,:,2) * mps240{4}(:,:,1);
psi240(16) = mps240{1}(:,:,2) * mps240{2}(:,:,2) * mps240{3}(:,:,2) * mps240{4}(:,:,2);
% 330
psi330(1) = mps330{1}(:,:,1) * mps330{2}(:,:,1) * mps330{3}(:,:,1);
psi330(2) = mps330{1}(:,:,1) * mps330{2}(:,:,1) * mps330{3}(:,:,2);
psi330(3) = mps330{1}(:,:,1) * mps330{2}(:,:,1) * mps330{3}(:,:,3);
psi330(4) = mps330{1}(:,:,1) * mps330{2}(:,:,2) * mps330{3}(:,:,1);
psi330(5) = mps330{1}(:,:,1) * mps330{2}(:,:,2) * mps330{3}(:,:,2);
psi330(6) = mps330{1}(:,:,1) * mps330{2}(:,:,2) * mps330{3}(:,:,3);
psi330(7) = mps330{1}(:,:,1) * mps330{2}(:,:,3) * mps330{3}(:,:,1);
psi330(8) = mps330{1}(:,:,1) * mps330{2}(:,:,3) * mps330{3}(:,:,2);
psi330(9) = mps330{1}(:,:,1) * mps330{2}(:,:,3) * mps330{3}(:,:,3);
psi330(10) = mps330{1}(:,:,2) * mps330{2}(:,:,1) * mps330{3}(:,:,1);
psi330(11) = mps330{1}(:,:,2) * mps330{2}(:,:,1) * mps330{3}(:,:,2);
psi330(12) = mps330{1}(:,:,2) * mps330{2}(:,:,1) * mps330{3}(:,:,3);
psi330(13) = mps330{1}(:,:,2) * mps330{2}(:,:,2) * mps330{3}(:,:,1);
psi330(14) = mps330{1}(:,:,2) * mps330{2}(:,:,2) * mps330{3}(:,:,2);
psi330(15) = mps330{1}(:,:,2) * mps330{2}(:,:,2) * mps330{3}(:,:,3);
psi330(16) = mps330{1}(:,:,2) * mps330{2}(:,:,3) * mps330{3}(:,:,1);
psi330(17) = mps330{1}(:,:,2) * mps330{2}(:,:,3) * mps330{3}(:,:,2);
psi330(18) = mps330{1}(:,:,2) * mps330{2}(:,:,3) * mps330{3}(:,:,3);
psi330(19) = mps330{1}(:,:,3) * mps330{2}(:,:,1) * mps330{3}(:,:,1);
psi330(20) = mps330{1}(:,:,3) * mps330{2}(:,:,1) * mps330{3}(:,:,2);
psi330(21) = mps330{1}(:,:,3) * mps330{2}(:,:,1) * mps330{3}(:,:,3);
psi330(22) = mps330{1}(:,:,3) * mps330{2}(:,:,2) * mps330{3}(:,:,1);
psi330(23) = mps330{1}(:,:,3) * mps330{2}(:,:,2) * mps330{3}(:,:,2);
psi330(24) = mps330{1}(:,:,3) * mps330{2}(:,:,2) * mps330{3}(:,:,3);
psi330(25) = mps330{1}(:,:,3) * mps330{2}(:,:,3) * mps330{3}(:,:,1);
psi330(26) = mps330{1}(:,:,3) * mps330{2}(:,:,3) * mps330{3}(:,:,2);
psi330(27) = mps330{1}(:,:,3) * mps330{2}(:,:,3) * mps330{3}(:,:,3);
% 242
psi242(1) = mps242{1}(:,:,1) * mps242{2}(:,:,1) * mps242{3}(:,:,1) * mps242{4}(:,:,1);
psi242(2) = mps242{1}(:,:,1) * mps242{2}(:,:,1) * mps242{3}(:,:,1) * mps242{4}(:,:,2);
psi242(3) = mps242{1}(:,:,1) * mps242{2}(:,:,1) * mps242{3}(:,:,2) * mps242{4}(:,:,1);
psi242(4) = mps242{1}(:,:,1) * mps242{2}(:,:,1) * mps242{3}(:,:,2) * mps242{4}(:,:,2);
psi242(5) = mps242{1}(:,:,1) * mps242{2}(:,:,2) * mps242{3}(:,:,1) * mps242{4}(:,:,1);
psi242(6) = mps242{1}(:,:,1) * mps242{2}(:,:,2) * mps242{3}(:,:,1) * mps242{4}(:,:,2);
psi242(7) = mps242{1}(:,:,1) * mps242{2}(:,:,2) * mps242{3}(:,:,2) * mps242{4}(:,:,1);
psi242(8) = mps242{1}(:,:,1) * mps242{2}(:,:,2) * mps242{3}(:,:,2) * mps242{4}(:,:,2);
psi242(9) = mps242{1}(:,:,2) * mps242{2}(:,:,1) * mps242{3}(:,:,1) * mps242{4}(:,:,1);
psi242(10) = mps242{1}(:,:,2) * mps242{2}(:,:,1) * mps242{3}(:,:,1) * mps242{4}(:,:,2);
psi242(11) = mps242{1}(:,:,2) * mps242{2}(:,:,1) * mps242{3}(:,:,2) * mps242{4}(:,:,1);
psi242(12) = mps242{1}(:,:,2) * mps242{2}(:,:,1) * mps242{3}(:,:,2) * mps242{4}(:,:,2);
psi242(13) = mps242{1}(:,:,2) * mps242{2}(:,:,2) * mps242{3}(:,:,1) * mps242{4}(:,:,1);
psi242(14) = mps242{1}(:,:,2) * mps242{2}(:,:,2) * mps242{3}(:,:,1) * mps242{4}(:,:,2);
psi242(15) = mps242{1}(:,:,2) * mps242{2}(:,:,2) * mps242{3}(:,:,2) * mps242{4}(:,:,1);
psi242(16) = mps242{1}(:,:,2) * mps242{2}(:,:,2) * mps242{3}(:,:,2) * mps242{4}(:,:,2);
% 332
psi332(1) = mps332{1}(:,:,1) * mps332{2}(:,:,1) * mps332{3}(:,:,1);
psi332(2) = mps332{1}(:,:,1) * mps332{2}(:,:,1) * mps332{3}(:,:,2);
psi332(3) = mps332{1}(:,:,1) * mps332{2}(:,:,1) * mps332{3}(:,:,3);
psi332(4) = mps332{1}(:,:,1) * mps332{2}(:,:,2) * mps332{3}(:,:,1);
psi332(5) = mps332{1}(:,:,1) * mps332{2}(:,:,2) * mps332{3}(:,:,2);
psi332(6) = mps332{1}(:,:,1) * mps332{2}(:,:,2) * mps332{3}(:,:,3);
psi332(7) = mps332{1}(:,:,1) * mps332{2}(:,:,3) * mps332{3}(:,:,1);
psi332(8) = mps332{1}(:,:,1) * mps332{2}(:,:,3) * mps332{3}(:,:,2);
psi332(9) = mps332{1}(:,:,1) * mps332{2}(:,:,3) * mps332{3}(:,:,3);
psi332(10) = mps332{1}(:,:,2) * mps332{2}(:,:,1) * mps332{3}(:,:,1);
psi332(11) = mps332{1}(:,:,2) * mps332{2}(:,:,1) * mps332{3}(:,:,2);
psi332(12) = mps332{1}(:,:,2) * mps332{2}(:,:,1) * mps332{3}(:,:,3);
psi332(13) = mps332{1}(:,:,2) * mps332{2}(:,:,2) * mps332{3}(:,:,1);
psi332(14) = mps332{1}(:,:,2) * mps332{2}(:,:,2) * mps332{3}(:,:,2);
psi332(15) = mps332{1}(:,:,2) * mps332{2}(:,:,2) * mps332{3}(:,:,3);
psi332(16) = mps332{1}(:,:,2) * mps332{2}(:,:,3) * mps332{3}(:,:,1);
psi332(17) = mps332{1}(:,:,2) * mps332{2}(:,:,3) * mps332{3}(:,:,2);
psi332(18) = mps332{1}(:,:,2) * mps332{2}(:,:,3) * mps332{3}(:,:,3);
psi332(19) = mps332{1}(:,:,3) * mps332{2}(:,:,1) * mps332{3}(:,:,1);
psi332(20) = mps332{1}(:,:,3) * mps332{2}(:,:,1) * mps332{3}(:,:,2);
psi332(21) = mps332{1}(:,:,3) * mps332{2}(:,:,1) * mps332{3}(:,:,3);
psi332(22) = mps332{1}(:,:,3) * mps332{2}(:,:,2) * mps332{3}(:,:,1);
psi332(23) = mps332{1}(:,:,3) * mps332{2}(:,:,2) * mps332{3}(:,:,2);
psi332(24) = mps332{1}(:,:,3) * mps332{2}(:,:,2) * mps332{3}(:,:,3);
psi332(25) = mps332{1}(:,:,3) * mps332{2}(:,:,3) * mps332{3}(:,:,1);
psi332(26) = mps332{1}(:,:,3) * mps332{2}(:,:,3) * mps332{3}(:,:,2);
psi332(27) = mps332{1}(:,:,3) * mps332{2}(:,:,3) * mps332{3}(:,:,3);

%% norm-check 
assert(abs(ctranspose(psi230)*psi230 - 1) <= tol, 'Error: MPSNorm failing to normalise to within 1E-12 tolerance');
assert(abs(ctranspose(psi240)*psi240 - 1) <= tol, 'Error: MPSNorm failing to normalise to within 1E-12 tolerance');
assert(abs(ctranspose(psi330)*psi330 - 1) <= tol, 'Error: MPSNorm failing to normalise to within 1E-12 tolerance');
assert(abs(ctranspose(psi242)*psi242 - 1) <= tol, 'Error: MPSNorm failing to normalise to within 1E-12 tolerance');
assert(abs(ctranspose(psi332)*psi332 - 1) <= tol, 'Error: MPSNorm failing to normalise to within 1E-12 tolerance');
